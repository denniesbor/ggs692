(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function c(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=c(r);fetch(r.href,s)}})();const k={0:0/3.28084,1:10/3.28084,2:20/3.28084,3:30/3.28084,4:50/3.28084};Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJkMWQ5YjIyMy03NzNlLTQxMDctYTAyZi1iYjUxNzVhMzJhYTciLCJpZCI6MjAzMTIxLCJpYXQiOjE3MTA4ODE4Njl9.X2zImhAc6KF1bpekSv6Y-VxWt6lwOR6W3xZMrjgh16A";async function j(){window.mainViewer||(window.mainViewer=new Cesium.Viewer("cesiumContainer",{}));const i=window.mainViewer;i.entities.removeAll();try{const l=await Cesium.Cesium3DTileset.fromIonAssetId(2532045);i.scene.primitives.add(l),await l.readyPromise;const c=l.boundingSphere,o=Cesium.Cartographic.fromCartesian(c.center),r=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,0),s=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height),u=Cesium.Cartesian3.subtract(r,s,new Cesium.Cartesian3);l.modelMatrix=Cesium.Matrix4.fromTranslation(u),await i.zoomTo(l)}catch(l){console.error("Failed to load tileset:",l)}}function z(i,l,c){c=String(c);const o=l.lat,r=l.lng;let s=k[c];s+=2,console.log("Zooming to:",o,r,s),window.mainViewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(r,o,s),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-30),roll:0},duration:2})}function J(i,l,c,o){const r=document.querySelector(".slider"),s=document.getElementById("routeSlider"),u=document.getElementById("startPoint"),C=document.getElementById("endPoint");let p=k[o];if(console.log("Setting up route slider for floor",p),u.textContent=l,C.textContent=c,i&&i.length>0){r.style.display="block",s.max=i.length-1,s.value=0;const f=i[0];f&&O(f,p),s.oninput=function(){const m=parseInt(this.value,10),I=i[m];I&&O(I,p)}}else r.style.display="none"}function O(i,l){const[c,o]=i;console.log("Heighty",l),console.log(l),window.mainViewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(c,o,l),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-30),roll:0},duration:2})}let E;async function D(i){return E?_(E,i):(E=L.map("leafletContainer").setView([51.505,-.09],18),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',maxZoom:25}).addTo(E),i&&(console.log(i),_(E,i))),E}function _(i,l){i.eachLayer(o=>{o instanceof L.GeoJSON&&i.removeLayer(o)});const c=L.geoJSON(l,{onEachFeature:(o,r)=>{const s=L.tooltip({direction:"center",permanent:!0,interactive:!0,noWrap:!0,opacity:.8,className:"feature-label"});r.on("click",()=>{console.log("Label clicked:",o.properties.id);let u=o.properties.level_name;z(o.properties.id,r.getBounds().getCenter(),u)}),r.bindTooltip(s),i.on("zoomend",()=>{const u=i.getZoom();let C=o.properties.unique_name;if(C){const h=C.split(" ");if(h.length===2||h.length===3)C=h[0]+"<br>"+h.slice(1).join(" ");else if(h.length>3){const p=[];for(let f=0;f<h.length;f+=3)p.push(h.slice(f,Math.min(f+3,h.length)).join(" "));C=p.join("<br>")}}u>19&&C?(s.setContent(C),r.bindTooltip(s).openTooltip(r.getBounds().getCenter())):r.unbindTooltip()})}}).addTo(i);c.getLayers().length>0&&i.fitBounds(c.getBounds())}var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},A={exports:{}};(function(i,l){(function(){var c,o,r,s,u,C,h,p,f,m,I,y,w,b,T;r=Math.floor,m=Math.min,o=function(e,t){return e<t?-1:e>t?1:0},f=function(e,t,n,a,g){var d;if(n==null&&(n=0),g==null&&(g=o),n<0)throw new Error("lo must be non-negative");for(a==null&&(a=e.length);n<a;)d=r((n+a)/2),g(t,e[d])<0?a=d:n=d+1;return[].splice.apply(e,[n,n-n].concat(t)),t},C=function(e,t,n){return n==null&&(n=o),e.push(t),b(e,0,e.length-1,n)},u=function(e,t){var n,a;return t==null&&(t=o),n=e.pop(),e.length?(a=e[0],e[0]=n,T(e,0,t)):a=n,a},p=function(e,t,n){var a;return n==null&&(n=o),a=e[0],e[0]=t,T(e,0,n),a},h=function(e,t,n){var a;return n==null&&(n=o),e.length&&n(e[0],t)<0&&(a=[e[0],t],t=a[0],e[0]=a[1],T(e,0,n)),t},s=function(e,t){var n,a,g,d,v,S;for(t==null&&(t=o),d=(function(){S=[];for(var R=0,M=r(e.length/2);0<=M?R<M:R>M;0<=M?R++:R--)S.push(R);return S}).apply(this).reverse(),v=[],a=0,g=d.length;a<g;a++)n=d[a],v.push(T(e,n,t));return v},w=function(e,t,n){var a;if(n==null&&(n=o),a=e.indexOf(t),a!==-1)return b(e,0,a,n),T(e,a,n)},I=function(e,t,n){var a,g,d,v,S;if(n==null&&(n=o),g=e.slice(0,t),!g.length)return g;for(s(g,n),S=e.slice(t),d=0,v=S.length;d<v;d++)a=S[d],h(g,a,n);return g.sort(n).reverse()},y=function(e,t,n){var a,g,d,v,S,R,M,B,N;if(n==null&&(n=o),t*10<=e.length){if(d=e.slice(0,t).sort(n),!d.length)return d;for(g=d[d.length-1],M=e.slice(t),v=0,R=M.length;v<R;v++)a=M[v],n(a,g)<0&&(f(d,a,0,null,n),d.pop(),g=d[d.length-1]);return d}for(s(e,n),N=[],S=0,B=m(t,e.length);0<=B?S<B:S>B;0<=B?++S:--S)N.push(u(e,n));return N},b=function(e,t,n,a){var g,d,v;for(a==null&&(a=o),g=e[n];n>t;){if(v=n-1>>1,d=e[v],a(g,d)<0){e[n]=d,n=v;continue}break}return e[n]=g},T=function(e,t,n){var a,g,d,v,S;for(n==null&&(n=o),g=e.length,S=t,d=e[t],a=2*t+1;a<g;)v=a+1,v<g&&!(n(e[a],e[v])<0)&&(a=v),e[t]=e[a],t=a,a=2*t+1;return e[t]=d,b(e,S,t,n)},c=function(){e.push=C,e.pop=u,e.replace=p,e.pushpop=h,e.heapify=s,e.updateItem=w,e.nlargest=I,e.nsmallest=y;function e(t){this.cmp=t??o,this.nodes=[]}return e.prototype.push=function(t){return C(this.nodes,t,this.cmp)},e.prototype.pop=function(){return u(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(t){return this.nodes.indexOf(t)!==-1},e.prototype.replace=function(t){return p(this.nodes,t,this.cmp)},e.prototype.pushpop=function(t){return h(this.nodes,t,this.cmp)},e.prototype.heapify=function(){return s(this.nodes,this.cmp)},e.prototype.updateItem=function(t){return w(this.nodes,t,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return this.nodes.length===0},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return t=new e,t.nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),function(e,t){return i.exports=t()}(this,function(){return c})}).call(V)})(A);const P="https://gist.githubusercontent.com/denniesbor/1281c233cdaa83e9c35621d83b10ea7e/raw/f3e31d515d8cf038a92551d1ea00da91cc4e1fc0/all_floors_data.json";async function G(){try{const i=await fetch(P);if(!i.ok)throw new Error("Network response was not ok "+i.statusText);return await i.json()}catch(i){console.error("Could not load the JSON data:",i)}}async function F(i,l,c){const o=await G();let r,s;if(o){const y=o[c];r=y.graph,s=y.coordinates}if(i=String(i),l=String(l),c=String(c),console.log("Finding path from",i,"to",l,"on floor",c),!r||i==l)return[];console.log("Graph data loaded:",r);let u={},C={},h=new Set,p=Object.keys(r);for(p.forEach(y=>u[y]=1/0),u[i.toString()]=0;p.length;){p=p.filter(w=>!h.has(w)),p.sort((w,b)=>u[w]-u[b]);let y=p.shift();if(u[y]===1/0){console.log("Break: remaining nodes are unreachable.");break}h.add(y),console.log("Visiting Node:",y,"Distance:",u[y]),Object.keys(r[y]).forEach(w=>{if(!h.has(w)){let b=u[y]+r[y][w];b<u[w]&&(u[w]=b,C[w]=y,console.log(`Updating path: ${w} reached from ${y} with distance ${b}`))}})}let f=[],m=l.toString();if(!C[l])return console.log("No path found to",l),[];for(;m!==i.toString();){if(!m||!C[m])return console.log("Broken path at:",m),[];f.unshift(m),m=C[m]}return f.unshift(i.toString()),q(f,s)}function q(i,l){let c=[];for(let o of i)l[o]?c.push(l[o]):console.error("Coordinates for node",o,"not found.");return c}const H=async i=>{try{return await(await fetch(i)).json()}catch(l){console.error("Error fetching the GeoJSON data:",l)}},W="https://gist.githubusercontent.com/denniesbor/f8ee9d1e675ff1652478de508ad5b000/raw/5b804b3d7e3067fd606a68e0b797a19b8768e637/exploratory_hall.geojson";let x=null;async function Y(i,l,c,o,r){let s=await F(i,l,r);if(s){x&&(console.log("Removing existing layer"),E.removeLayer(x));let u=L.layerGroup(),C=200;s.forEach((h,p)=>{h&&p<s.length-1&&setTimeout(()=>{let f=[h[1],h[0]],m=[s[p+1][1],s[p+1][0]];L.polyline([f,m],{color:"red",weight:4,dashArray:"10, 10",lineJoin:"round"}).addTo(u),p===0&&u.addTo(E)},C*p)}),x=u,J(s,c,o,r),console.log("Route updated on map")}}document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("buildingSelect");const i=document.getElementById("startRoomSelect"),l=document.getElementById("endRoomSelect"),c=document.getElementById("routeButton");document.getElementById("floorBanner");const o=document.querySelector(".slider"),r=await H(W);let s="0";u(r),C(s);function u(f){const m=new Set;f.features.forEach(w=>{w.properties&&w.properties.level_name&&m.add(w.properties.level_name)});const I=document.getElementById("floorBanner");I.innerHTML="";let y=null;m.forEach(w=>{const b=document.createElement("button");b.textContent=`Floor ${w}`,b.onclick=async()=>{x&&(console.log("Removing existing layer"),E.removeLayer(x),o.style.display="none"),s=w;const T=h(f,w);await p(T),b.classList.add("active"),I.querySelectorAll("button").forEach(t=>{t!==b&&t.classList.remove("active")})},I.appendChild(b),w==="0"&&(y=b)}),y&&y.click()}async function C(f){const m=h(r,f);await p(m)}function h(f,m){return Z(f,m),{type:"FeatureCollection",features:f.features.filter(I=>I.properties.level_name===m)}}c.addEventListener("click",()=>{const f=i.value,m=l.value,I=i.options[i.selectedIndex].text,y=l.options[l.selectedIndex].text;Y(f,m,I,y,s)});async function p(f){console.log("Initializing with filtered data:",f),await D(f),await j()}});function Z(i,l){const c=new Set;i.features.forEach(o=>{o.properties&&o.properties.unique_name&&o.properties.level_name===l&&c.add({name:o.properties.unique_name,id:o.properties.id})}),startRoomSelect.innerHTML="",endRoomSelect.innerHTML="",c.forEach(o=>{const r=document.createElement("option");r.value=o.id,r.text=o.name,startRoomSelect.appendChild(r);const s=document.createElement("option");s.value=o.id,s.text=o.name,endRoomSelect.appendChild(s)})}
